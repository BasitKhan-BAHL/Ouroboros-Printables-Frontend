import{a,p as l}from"./chunk-EPOLDU6W-CtFcexyP.js";import{b as y,f as m}from"./catalog-rN0cebLw.js";const f=a.createContext(null);function E(t,u){switch(u.type){case"ADD_ITEM":{const{productId:r}=u;return t.items.find(n=>n.productId===r)?{...t,items:t.items.map(n=>n.productId===r?{...n,quantity:n.quantity+1}:n)}:{...t,items:[...t.items,{productId:r,quantity:1}]}}case"INCREMENT":{const{productId:r}=u;return{...t,items:t.items.map(e=>e.productId===r?{...e,quantity:e.quantity+1}:e)}}case"DECREMENT":{const{productId:r}=u;return{...t,items:t.items.map(e=>e.productId===r?{...e,quantity:e.quantity-1}:e).filter(e=>e.quantity>0)}}case"REMOVE":{const{productId:r}=u;return{...t,items:t.items.filter(e=>e.productId!==r)}}case"CLEAR":return{...t,items:[]};default:return t}}const I={items:[]};function x({children:t}){const[u,r]=a.useReducer(E,I,n=>{if(typeof window>"u")return n;try{const s=window.localStorage.getItem("cart");if(!s)return n;const i=JSON.parse(s);return!i||!Array.isArray(i.items)?n:{items:i.items}}catch{return n}});a.useEffect(()=>{if(!(typeof window>"u"))try{window.localStorage.setItem("cart",JSON.stringify(u))}catch{}},[u]);const e=a.useMemo(()=>{const n=u.items.map(({productId:o,quantity:c})=>{const d=y(o);if(!d)return null;const p=d.price*c;return{productId:o,quantity:c,product:d,lineTotal:p,lineTotalFormatted:m(p)}}).filter(Boolean),s=n.reduce((o,c)=>o+c.lineTotal,0),i=n.reduce((o,c)=>o+c.quantity,0);return{items:n,subtotal:s,subtotalFormatted:m(s),total:s,totalFormatted:m(s),totalQuantity:i,addItem:o=>r({type:"ADD_ITEM",productId:o}),increment:o=>r({type:"INCREMENT",productId:o}),decrement:o=>r({type:"DECREMENT",productId:o}),removeItem:o=>r({type:"REMOVE",productId:o}),clear:()=>r({type:"CLEAR"})}},[u]);return l.jsx(f.Provider,{value:e,children:t})}function R(){const t=a.useContext(f);if(!t)throw new Error("useCart must be used within a CartProvider");return t}export{x as C,R as u};
